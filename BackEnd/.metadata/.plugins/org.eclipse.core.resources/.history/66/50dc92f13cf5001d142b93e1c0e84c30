package com.cognizant.influentia.contentms.controller;

import java.util.*;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.*;
import org.springframework.web.bind.annotation.*;

import com.cognizant.influentia.contentms.dto.*;
import com.cognizant.influentia.contentms.entity.*;
import com.cognizant.influentia.contentms.service.*;

@RestController
@RequestMapping("/api/content")
public class ContentMSController {
	
	@Autowired
	ContentManagementService cmService;

	@GetMapping("/getSubsPlanLimits/{SubscriberID}")
	public SubscriptionPlanLimitsDTO fetchSubsPLById(@PathVariable("SubscriberID") int id) {
		return cmService.getPlan(id);
	}
	
	@PostMapping("/add")
	public ResponseEntity<UserPosts> addNewUserPosts(@RequestBody UserPosts userpost) {
		UserPosts createdPost = cmService.addNewPost(userpost);
		return new ResponseEntity<UserPosts>(createdPost, HttpStatus.CREATED);
	}
	
	@GetMapping("/{username}")
	public ResponseEntity<List<UserPostsDTO>> getUserPostsOfUser(@PathVariable("username") String username) {
		return new ResponseEntity<List<UserPostsDTO>>(cmService.getUserPostsByUserName(username), HttpStatus.FOUND);
	}
	
	@PutMapping("/{Username}/cancel/{PostID}")
	public ResponseEntity<String> cancelScheduledPost(@PathVariable("Username") String username, @PathVariable("PostID") int id) {
		int numberOfUpdations = cmService.cancelScheduledPost(username, id);
		if(numberOfUpdations > 0)
			return new ResponseEntity<String>("Successfully cancelled a post :)", HttpStatus.ACCEPTED);
		return new ResponseEntity<String>("Failed in cancelling the post :(", HttpStatus.NOT_IMPLEMENTED);
	}
	
	@GetMapping("/analytics")
	public ResponseEntity<List<UserPostsDTO>> getUserPostsBasedOnAnalytics(@RequestParam Map<String, String> parameterList) {
		return new ResponseEntity<List<UserPostsDTO>>(cmService.filteredUserPosts(parameterList), HttpStatus.FOUND);
	}
}